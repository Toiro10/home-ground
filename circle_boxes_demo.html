<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Circle Row Demo</title>
  <style>
    body {
      margin: 0;
      background: #ffffff;
    }

    /* オーバーレイ全体（カメラ枠） */
    .row-wrapper {
      position: relative;
      width: 100vw;
      height: 180px;
      overflow: hidden;
      background: #ffffff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
    }

    /* 流れていく横一列（列自体はJSで translateX 制御） */
    .circle-row {
      position: absolute;
      top: 60px;
      left: 0;
      display: flex; /* 左→右にセルを並べる（JSでカメラを右側から追う） */
      gap: 40px;
      will-change: transform;
      transform: translateX(100vw); /* 最初は画面外（右）に寄せておく */
    }

    /* ひとつ分の □＋○ セット */
    .cell {
      position: relative;
      width: 60px;
      height: 60px;
    }

    .cell-box {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 36px;
      height: 36px;
      border: 1px solid #000;
      background: transparent;
    }

    .cell-circle {
      position: absolute;
      top: 0;
      left: 0;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 4px solid red;
      box-sizing: border-box;
      opacity: 0;
      transform: scale(0.7);
      transition: opacity 0.25s ease, transform 0.25s ease;
    }

    .cell.active .cell-circle {
      opacity: 1;
      transform: scale(1);
    }

    /* 最後にかぶさるホワイトフェード */
    .white-cover {
      position: absolute;
      inset: 0;
      background: #ffffff;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.8s ease;
    }

    .white-cover.show {
      opacity: 1;
    }

    /* 中央テキスト（今回はデモ用） */
    .caption {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.8s ease 0.4s;
      font-size: 20px;
    }

    .caption.show {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="row-wrapper">
    <div class="circle-row" id="circleRow">
      <!-- □＋○ を好きな数だけ並べる -->
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
      <div class="cell"><div class="cell-box"></div><div class="cell-circle"></div></div>
    </div>

    <div class="white-cover" id="whiteCover"></div>

    <div class="caption" id="caption">
      彼の善良さは、空欄を埋めるだけで生まれている。
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const row = document.getElementById("circleRow");
      const cells = Array.from(document.querySelectorAll(".cell"));
      const cover = document.getElementById("whiteCover");
      const caption = document.getElementById("caption");

      // ○の付く「ヘッド」をどの位置で追いかけるか（画面幅の何％あたりか）
      const HEAD_RATIO = 0.75; // 0.8 にするともっと右寄り
      // セル＋隙間のだいたいの幅（px）: デザイン見ながら微調整
      const STEP_PX = 100;

      // ヘッド index をもとに、列全体の translateX を計算
      function updateRowPosition(activeIndex) {
        const vw = window.innerWidth;
        const headX = vw * HEAD_RATIO;
        const offsetX = headX - activeIndex * STEP_PX;
        row.style.transform = `translateX(${offsetX}px)`;
      }

      // 最初はまだ何も付いていない状態 → 列全体を右側に寄せておく
      updateRowPosition(0);

      // ○ を一つずつ出していく（右から左へ「伸びていく」ように見える）
      let index = 0;
      let interval = 450; // 最初の間隔（ms）

      function step() {
        if (index < cells.length) {
          cells[index].classList.add("active"); // ○を付ける
          updateRowPosition(index); // カメラ（translateX）をヘッドに合わせて移動
          index++;

          // だんだん速くする（下限80ms）
          interval = Math.max(80, interval * 0.8);
          setTimeout(step, interval);
        } else {
          // 全部に○がついたら白フェード
          cover.classList.add("show");

          // その後テキスト
          setTimeout(() => {
            caption.classList.add("show");
          }, 900);
        }
      }

      // 少し溜めてからスタート
      setTimeout(step, 600);
    });
  </script>

  <a href="character_b.html"
   style="
     position: fixed;
     top: 16px;
     left: 16px;
     font-size: 12px;
     color: #000;
     text-decoration: underline;
     z-index: 1000;
   ">
    ← キャラクターBに戻る
  </a>
</body>
</html>
